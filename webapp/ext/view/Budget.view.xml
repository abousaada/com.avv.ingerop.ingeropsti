<mvc:View
    xmlns:core="sap.ui.core"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns:layout="sap.ui.layout"
    controllerName="com.avv.ingerop.ingeropsti.ext.controller.Budget"
>
    <layout:VerticalLayout width="100%">
        <Toolbar>
            <content>
                <ToolbarSpacer />
                <Button
                    id="addLineBtn"
                    icon="sap-icon://add"
                    text="Add Line"
                    press="onAddBudgetLine"
                    type="Emphasized"
                    enabled="{
                        parts: [
                            { path: 'ui>/editable' },
                            { path: 'missions>/results' }
                        ],
                        formatter: '.enableAddLine'
                    }"
                />
            </content>
        </Toolbar>

        <Table
            id="budgetTable"
            inset="false"
            growing="true"
            growingScrollToLoad="true"
            mode="None"
            items="{budget>/results}"
        >
            <columns>
                <Column width="280px">
                    <Text text="Mission sous-traitée" />
                </Column>
                <Column width="230px">
                    <Text text="Mission associée" />
                </Column>
                <Column>
                    <Text text="Libellé" />
                </Column>
                <Column>
                    <Text text="MissionCode" />
                </Column>
                <Column>
                    <Text text="Regroupement" />
                </Column>
                <Column>
                    <Text text="Date de début" />
                </Column>
                <Column>
                    <Text text="Date de fin" />
                </Column>
                <Column>
                    <Text text="Budget sous-traité (recette)" />
                </Column>
                <Column>
                    <Text text="Devise" />
                </Column>
                <Column width="80px">
                    <Text text="Actions" />
                </Column>
            </columns>

            <items>
                <ColumnListItem>
                    <cells>
                        <Select
                            items="{
                                path: 'missions>/results',
                                templateShareable: false
                            }"
                            editable="{
                                path: 'budget>isNew',
                                formatter: '.isLineEditable'
                            }"
                            selectedKey="{budget>Mission_e}"
                            change="onMissionChange"
                        >
                            <core:Item
                                key="{missions>MissionId}"
                                text="{missions>MissionId}"
                            />
                        </Select>
                        <Text text="{budget>Mission_p}" />
                        <Input
                            value="{budget>Libelle}"
                            editable="{
                                path: 'budget>isNew',
                                formatter: '.isLineEditable'
                            }"
                        />
                        <Text text="{budget>MissionCode}" />
                        <Text text="{budget>Regroupement}" />
                        <DatePicker
                            value="{path: 'budget>StartDate', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'yyyy-MM-dd' }}"
                            displayFormat="short"
                            editable="{
                                path: 'budget>isNew',
                                formatter: '.isLineEditable'
                            }"
                            width="100%"
                            required="true"
                        />

                        <DatePicker
                            value="{path: 'budget>EndDate', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'yyyy-MM-dd' }}"
                            displayFormat="short"
                            editable="{
                                path: 'budget>isNew',
                                formatter: '.isLineEditable'
                            }"
                            width="100%"
                            required="true"
                        />

                        <Input
                            value="{budget>BudgetAlloue}"
                            editable="{
                                path: 'budget>isNew',
                                formatter: '.isLineEditable'
                            }"
                            type="Number"
                            placeholder="0.00"
                        />
                        <Text text="{budget>Currency}" />
                        <Button
                            icon="sap-icon://delete"
                            type="Reject"
                            press="onDeleteBudgetLine"
                        />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
    </layout:VerticalLayout>
</mvc:View>
